/// Work out the required size for the cell.
///
/// @param {Number|List} $layout - The single value/list to work out sizing.
/// @param {Number}      $index  - The position of the list to get the value from.
/// @param {Number}      $gutter - The gutter value to substract from the size.
///
/// @return {String}
///
@function _cell-size($layout, $index, $gutter) {

  // Total number of cells in our layout.
  // If this is a list this will be the list values added together,
  // otherwise its the single value supplied.
  $total: if(type-of($layout) == 'list', sum($layout), $layout);

  // Length of the list if applicable
  $length: length($layout);

  // Item from the list matching the given index
  $item: if(type-of($layout) == 'list', nth($layout, $index), 1);

  // All fractional (unitless) values within $layout
  $fractional: _filter-fractional($layout);

  // All values in $layout with units
  $static: _filter-static($layout, length($fractional), '-');

  // Gutter value to subtract from the calc() declaration
  $gutter-allowance: if($gutter != 0, _gutter-allowance($gutter, $layout), null);

  // Zero the size ready...
  $size: 0;

  // Shrink behaviour (auto width/height)
  @if $item == 0 {
    $size: auto;
  }

  // Values with units
  @else if not unitless($item) {
    @if $gutter-allowance {
      $size: calc(#{$item} - #{$gutter-allowance});
    }
    @else {
      $size: #{$item};
    }
  }

  // Values without units
  @else {
    @if $static {
      @if $gutter-allowance {
        $size: calc(#{percentage($item / $total)} #{$static} - #{$gutter-allowance});
      }
      @else {
        $size: calc(#{percentage($item / $total)} #{$static});
      }
    }
    @else {
      @if $gutter-allowance {
        $size: calc(#{percentage($item / $total)} - #{$gutter-allowance});
      }
      @else {
        $size: percentage($item / $total);
      }
    }
  }

  @return $size;
}

// Skeleton of new sizing function
@function _cell-size($layout, $index, $gutter) {
  $gutter: _gutter-allowance($layout, $gutter);
  $item: nth($layout, $index);
  $total: length($layout);
  $fixed: 10px 20px; // get fixed (not unitless) values
  $fluid: 1 2 3; // get fluid (unitless) values
  $calc-required: true; // set to true if gutter and fixed value (needs function)

  // Base percentage calculation
  $size: 100% * $item / $total;

  // If we have non fluid value use that instead
  @if not unitless($item) {
      $size: $item;
  }

  // Append any static values
  @if $static {
      @each $value in $static {
          $size: $size + ' - #{$value}';
      }
  }

  // Append the gutter if used
  @if $gutter {
      $size: $size + ' - #{$gutter}';
  }

  // Wrap size in calc() if needed
  @if $calc-required {
      $size: calc(#{$size});
  }

  @return $size;
}